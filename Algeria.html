<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Siksa Player - المستودع</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.15.9/shaka-player.ui.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.15.9/controls.min.css" rel="stylesheet">
    <style>
        body { margin: 0; background: #000; height: 100vh; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        #container { width: 100%; height: 100%; }
        video { width: 100%; height: 100%; }
        #loader { position: absolute; color: white; font-family: sans-serif; text-align: center; }
        .spinner { border: 4px solid rgba(255,255,255,0.1); border-top: 4px solid #00ff88; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin-bottom: 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="loader">
        <div class="spinner"></div>
        <p>جاري تشغيل البث...</p>
    </div>

    <div id="container" data-shaka-player-container>
        <video id="video" autoplay crossorigin="anonymous"></video>
    </div>

    <script>
        // مصفوفة القنوات - أضف قنواتك هنا بسهولة
        const channels = {
            "sps1": {
                url: "https://sps1.starzplayarabia.com/out/v1/eee188845e9543699fd24e5a9890c6e2/index.mpd",
                key: "b253c726c24c7c94a3ddf9b1907e2c76:097963d6ad73c3d712a104981de0ed42"
            },
            "sps2": {
                url: "https://sps2.starzplayarabia.com/out/v1/9c44569429154f3a9e62310b1a0391d1/index.mpd",
                key: "b3f3e8095f924619b884967384a2d1d0:e7a96d2e67300c14c5b3641777990141"
            },
            "discovery": {
                url: "https://example.com/discovery.mpd",
                key: "key_id:key_value"
            },
            "nat_geo": {
                url: "https://example.com/natgeo.mpd",
                key: "key_id:key_value"
            },
            "fubo": {
                url: "https://fubo-sports-2-in.fubotv.com/playlist.mpd",
                key: "" // بدون تشفير
            }
        };

        async function init() {
            const video = document.getElementById('video');
            const container = document.getElementById('container');
            const player = new shaka.Player(video);
            
            // إضافة أزرار التحكم (UI)
            new shaka.ui.Overlay(player, container, video);

            const params = new URLSearchParams(window.location.search);
            const channel = channels[params.get('id')];

            if (!channel) {
                document.getElementById('loader').innerHTML = "❌ القناة غير موجودة";
                return;
            }

            // إعداد المفاتيح (ClearKey)
            if (channel.key) {
                const [kid, key] = channel.key.split(':');
                player.configure({ drm: { clearKeys: { [kid]: key } } });
            }

            // تحسين سلاسة البث
            player.configure({
                streaming: {
                    bufferingGoal: 10,
                    lowLatencyMode: true,
                    jumpLargeGaps: true
                }
            });

            try {
                await player.load(channel.url);
                document.getElementById('loader').style.display = 'none';
            } catch (e) {
                document.getElementById('loader').innerHTML = "❌ خطأ في تشغيل القناة";
            }
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
